{"ast":null,"code":"export const createAnimation = (stateA, stateB, delay) => ({\n  stateA,\n  stateB,\n  delay\n});\nconst getAnimationStates = function (animations) {\n  let stateName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"stateA\";\n  return animations.map(animation => animation[stateName]);\n};\nconst getMaxTransitionTime = transition => {\n  const re = /(\\d+)ms/g;\n  const times = [];\n  let matches;\n  while ((matches = re.exec(transition)) != null) {\n    times.push(parseInt(matches[1], 10));\n  }\n  return Math.max(...times);\n};\nconst getAnimationDuration = animation => {\n  if (animation instanceof Array) {\n    return animation.reduce((maxDuration, a) => {\n      const duration = getAnimationDuration(a);\n      if (duration > maxDuration) {\n        return duration;\n      }\n      return maxDuration;\n    }, 0);\n  }\n  const state = animation.stateB;\n  const maxTransition = state.transition ? getMaxTransitionTime(state.transition) : 0;\n  return maxTransition + animation.delay;\n};\nconst getMaxAnimationsDuration = animations => Math.max(...Object.values(animations).map(animations => getAnimationDuration(Object.values(animations))));\nexport const createAnimationRunner = function (animationsIn) {\n  let subscriber = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : () => {};\n  const animations = Object.entries(animationsIn).reduce((state, _ref) => {\n    let [name, animation] = _ref;\n    return {\n      ...state,\n      [name]: animation instanceof Array ? animation : [animation]\n    };\n  }, {});\n  let state = Object.entries(animations).reduce((state, _ref2) => {\n    let [name, animation] = _ref2;\n    return {\n      ...state,\n      [name]: getAnimationStates(animation)\n    };\n  }, {});\n  const animationsDuration = getMaxAnimationsDuration(animations);\n  const animate = (name, animation) => {\n    animation.forEach((a, index) => {\n      window.requestAnimationFrame(() => {\n        window.setTimeout(() => {\n          var _state$name, _state$name2;\n          state = {\n            ...state,\n            [name]: [...((_state$name = state[name]) === null || _state$name === void 0 ? void 0 : _state$name.slice(0, index)), a.stateB, ...((_state$name2 = state[name]) === null || _state$name2 === void 0 ? void 0 : _state$name2.slice(index + 1, state[name].length))]\n          };\n          subscriber();\n        }, a.delay);\n      });\n    });\n  };\n  return {\n    getState() {\n      return state;\n    },\n    run() {\n      Object.entries(animations).forEach(_ref3 => {\n        let [name, animation] = _ref3;\n        animate(name, animation);\n      });\n    },\n    awaitAnimationComplete(callback) {\n      window.setTimeout(callback, animationsDuration);\n    }\n  };\n};","map":{"version":3,"names":["createAnimation","stateA","stateB","delay","getAnimationStates","animations","stateName","map","animation","getMaxTransitionTime","transition","re","times","matches","exec","push","parseInt","Math","max","getAnimationDuration","Array","reduce","maxDuration","a","duration","state","maxTransition","getMaxAnimationsDuration","Object","values","createAnimationRunner","animationsIn","subscriber","entries","name","animationsDuration","animate","forEach","index","window","requestAnimationFrame","setTimeout","slice","length","getState","run","awaitAnimationComplete","callback"],"sources":["/Users/zeus/Desktop/Projects/6point6-NP-DEV/aoe_technology_radar/src/animation.ts"],"sourcesContent":["import React from \"react\";\n\nexport interface AnimationConfig {\n  [k: string]: Animation | Animation[];\n}\n\nexport type Animations = {\n  [k: string]: Animation[];\n};\n\nexport type AnimationStates = {\n  [k: string]: React.CSSProperties[];\n};\n\nexport type Animation = {\n  stateA: React.CSSProperties;\n  stateB: React.CSSProperties;\n  delay: number;\n  run?(callback: (state: any) => any): any; // todo fix\n  prepare?(callback: (state: any) => any): any; // todo fix\n};\n\nexport type AnimationRunner = {\n  getState(): AnimationStates;\n  run(): any;\n  awaitAnimationComplete(callback: () => void): any;\n};\n\nexport const createAnimation = (\n  stateA: React.CSSProperties,\n  stateB: React.CSSProperties,\n  delay: number\n): Animation => ({\n  stateA,\n  stateB,\n  delay,\n});\n\nconst getAnimationStates = (\n  animations: Animation[],\n  stateName: \"stateA\" | \"stateB\" = \"stateA\"\n): React.CSSProperties[] => {\n  return animations.map((animation) => animation[stateName]);\n};\n\nconst getMaxTransitionTime = (transition: string) => {\n  const re = /(\\d+)ms/g;\n  const times: number[] = [];\n  let matches;\n  while ((matches = re.exec(transition)) != null) {\n    times.push(parseInt(matches[1], 10));\n  }\n  return Math.max(...times);\n};\n\nconst getAnimationDuration = (animation: Animation | Animation[]): number => {\n  if (animation instanceof Array) {\n    return animation.reduce((maxDuration, a) => {\n      const duration = getAnimationDuration(a);\n      if (duration > maxDuration) {\n        return duration;\n      }\n      return maxDuration;\n    }, 0);\n  }\n\n  const state = animation.stateB;\n  const maxTransition = state.transition\n    ? getMaxTransitionTime(state.transition)\n    : 0;\n  return maxTransition + animation.delay;\n};\n\nconst getMaxAnimationsDuration = (animations: Animations) =>\n  Math.max(\n    ...Object.values(animations).map((animations) =>\n      getAnimationDuration(Object.values(animations))\n    )\n  );\n\nexport const createAnimationRunner = (\n  animationsIn: AnimationConfig,\n  subscriber: () => void = () => {}\n): AnimationRunner => {\n  const animations = Object.entries(animationsIn).reduce(\n    (state, [name, animation]) => ({\n      ...state,\n      [name]:\n        animation instanceof Array ? animation : ([animation] as Animation[]),\n    }),\n    {} as Animations\n  );\n\n  let state = Object.entries(animations).reduce(\n    (state, [name, animation]) => ({\n      ...state,\n      [name]: getAnimationStates(animation),\n    }),\n    {} as AnimationStates\n  );\n\n  const animationsDuration = getMaxAnimationsDuration(animations);\n\n  const animate = (name: string, animation: Animation[]) => {\n    animation.forEach((a, index) => {\n      window.requestAnimationFrame(() => {\n        window.setTimeout(() => {\n          state = {\n            ...state,\n            [name]: [\n              ...state[name]?.slice(0, index),\n              a.stateB,\n              ...state[name]?.slice(index + 1, state[name].length),\n            ],\n          };\n          subscriber();\n        }, a.delay);\n      });\n    });\n  };\n\n  return {\n    getState() {\n      return state;\n    },\n    run() {\n      Object.entries(animations).forEach(([name, animation]) => {\n        animate(name, animation);\n      });\n    },\n    awaitAnimationComplete(callback) {\n      window.setTimeout(callback, animationsDuration);\n    },\n  };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}